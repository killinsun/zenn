---
title: "vm.max_map_count 65535 is too low ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸæ™‚ã«ã‚„ã£ãŸã“ã¨"
emoji: "ðŸ®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["OpenSearch", "Elasticsearch", "Docker", "macOS", "RancherDesktop"]
published: true
---

Rancher for Desktop ã‚’ä½¿ã£ã¦ Elasticsearch ã‚„ OpenSearch ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ç«‹ã¡ä¸Šã’ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã«é­é‡ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

```
 max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]
```

ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ã€Elasticsearch ã‚„ OpenSearch ãŒåˆ©ç”¨ã™ã‚‹ãƒ¡ãƒ¢ãƒªãƒ¼ãƒžãƒƒãƒ—ã®ä¸Šé™ãŒå°‘ãªã„ã“ã¨ã§æ€’ã‚‰ã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚

## å¯¾å‡¦æ³•

`rdctl` ã‚’ä½¿ã£ã¦ Rancher Desktop ã®ç®¡ç†ã‚·ã‚§ãƒ«(Lima)ã‚’é–‹ãã€ä¸‹è¨˜ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

`sysctl`ã‚³ãƒžãƒ³ãƒ‰ã§ã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ã¦ã„ã¾ã™ãŒã€`-w` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å³æ™‚åæ˜ ã•ã‚Œã¾ã™ã€‚

```zsh
$ rdctl shell

lima-rancher-desktop:/{PATH}$ sudo sysctl -w vm.max_map_count=262144
```

æ°¸ç¶šçš„ã«åæ˜ ã•ã›ã‚‹ãŸã‚ã«ã¯ã€`/etc/sysctl.conf` ã«ä¸‹è¨˜ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

```zsh
lima-rancher-desktop:/{PATH}$ echo "vm.max_map_count=262144" | sudo tee -a /etc/sysctl.conf
lima-rancher-desktop:/{PATH}$ cat /etc/sysctl.conf

> # content of this file will override /etc/sysctl.*
> vm.max_map_count=262144
```

/ ä»¥ä¸Š